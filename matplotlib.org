* Matplotlib 소개: 그래프 그리기


Matplotlib는 Python에서 그래프를 그릴 때 사용하는 대표적인 라이브러리입니다. Pandas와 기본적으로 통합되어 있는 라이브러리이기도 합니다. Pandas에서 ~Series~ 나 ~DataFrame~ 의 메소드로 제공되는 ~plot()~ 함수는 기본적으로 matplotlib을 사용해서 그래프를 그립니다. 때문에 많은 기능들이 상호 호환됩니다.

여기서는 순수한 matplotlib을 사용해서 그래프를 그리는 방법을 살펴봅니다.


** 기초적인 그래프 그리기

아래와 같이 가장 기본적인 그래프를 그릴 수 있습니다.

#+BEGIN_SRC ipython :session :results raw :exports both :ipyfile outputs/matplotlib-first-plot.png
  %matplotlib inline
  import matplotlib.pyplot as plt

  plt.plot([1, 3, 2, 5, 4])
  plt.show();
#+END_SRC

#+RESULTS:
[[file:outputs/matplotlib-first-plot.png]]

NumPy의 ndarray로 그려도 동일합니다.

#+BEGIN_SRC ipython :session :results raw :exports both :ipyfile outputs/matplotlib-first-plot-2.png
  %matplotlib inline
  import numpy as np
  import matplotlib.pyplot as plt

  plt.plot(np.arange(10))
  plt.show();
#+END_SRC

#+RESULTS:
[[file:outputs/matplotlib-first-plot-2.png]]

Pandas의 Series로 그려도 동일합니다.

#+BEGIN_SRC ipython :session :results raw :exports both :ipyfile outputs/matplotlib-first-plot-3.png
  %matplotlib inline
  import pandas as pd
  import matplotlib.pyplot as plt

  plt.plot(pd.Series([1, 3, 2, 5, 4]))
  plt.show();
#+END_SRC

#+RESULTS:
[[file:outputs/matplotlib-first-plot-3.png]]

x축의 값을 지정하려면 아래와 같이 할 수 있습니다.

#+BEGIN_SRC ipython :session :results raw :exports both :ipyfile outputs/matplotlib-first-plot-4.png
  %matplotlib inline
  import pandas as pd
  import matplotlib.pyplot as plt

  plt.plot(['2011', '2012', '2013', '2014', '2015'], [1, 3, 2, 5, 4])
  plt.show();
#+END_SRC

#+RESULTS:
[[file:outputs/matplotlib-first-plot-4.png]]


** 여러 계열을 동시에 그리기

여러 계열의 데이터를 동시에 그리려면 아래와 같이 합니다.

#+BEGIN_SRC ipython :session :results raw :exports both :ipyfile outputs/matplotlib-multiseries-plot-1.png
  %matplotlib inline
  import pandas as pd
  import matplotlib.pyplot as plt

  x = ['2011', '2012', '2013', '2014', '2015']
  plt.plot(x, [1, 3, 2, 5, 4])
  plt.plot(x, [2, 1, 3, 1, 1])
  plt.show();
#+END_SRC

#+RESULTS:
[[file:outputs/matplotlib-multiseries-plot-1.png]]


** 제목 표시하기

그래프의 제목과 x,y축 이름을 붙이기 위해서는 ~title~, ~xlabel~, ~ylabel~ 함수를 사용합니다.

#+BEGIN_SRC ipython :session :results raw :exports both :ipyfile outputs/matplotlib-title-plot-1.png
  %matplotlib inline
  import pandas as pd
  import matplotlib.pyplot as plt

  plt.title('Test Plot')
  plt.xlabel('Tick')
  plt.ylabel('Value')
  plt.plot([1, 3, 2, 5, 4])
  plt.plot([2, 1, 3, 1, 1])
  plt.show();
#+END_SRC

#+RESULTS:
[[file:outputs/matplotlib-title-plot-1.png]]

** 범례 표시하기

범례를 표시하기 위해서는 아래와 같이 각 계열에 이름을 부여하고, ~plt.legend()~ 를 호출한 뒤 그래프를 그립니다.

#+BEGIN_SRC ipython :session :results raw :exports both :ipyfile outputs/matplotlib-legend-plot-1.png
  %matplotlib inline
  import pandas as pd
  import matplotlib.pyplot as plt

  plt.plot([1, 3, 2, 5, 4], label='서울')
  plt.plot([2, 1, 3, 1, 1], label='부산')
  plt.legend()
  plt.show();
#+END_SRC

#+RESULTS:
[[file:outputs/matplotlib-legend-plot-1.png]]


그런데 그려진 그래프에 한글이 제대로 표시되지 않는 것을 볼 수 있습니다. 이것은 적절한 한글 글꼴이 지정되지 않았기 때문입니다. 아래와 같이 폰트를 지정해줍니다. 폰트는 시스템 환경마다 다를 수 있습니다. Windows의 경우에는 'Malgun Gothic', MacOS의 경우에는 'AppleGothic'으로 지정해보세요.

#+BEGIN_SRC ipython :session :results raw :exports both :ipyfile outputs/matplotlib-legend-plot-2.png
  %matplotlib inline
  import pandas as pd
  import matplotlib
  import matplotlib.pyplot as plt
  matplotlib.rc('font', family='Noto Sans CJK KR')

  plt.plot([1, 3, 2, 5, 4], label='서울')
  plt.plot([2, 1, 3, 1, 1], label='부산')
  plt.legend()
  plt.show();
#+END_SRC

#+RESULTS:
[[file:outputs/matplotlib-legend-plot-2.png]]

** Grid 그리기

#+BEGIN_SRC ipython :session :results raw :exports both :ipyfile outputs/matplotlib-grid-plot-1.png
  %matplotlib inline
  import pandas as pd
  import matplotlib
  import matplotlib.pyplot as plt
  matplotlib.rc('font', family='Noto Sans CJK KR')

  x = ['2011', '2012', '2013', '2014', '2015']
  plt.plot(x, [1, 3, 2, 5, 4], label='서울')
  plt.plot(x, [2, 1, 3, 1, 1], label='부산')
  plt.grid()
  plt.show();
#+END_SRC

#+RESULTS:
[[file:outputs/matplotlib-grid-plot-1.png]]


#+BEGIN_SRC ipython :session :results raw :exports both :ipyfile outputs/matplotlib-grid-plot-2.png
  %matplotlib inline
  import pandas as pd
  import matplotlib
  import matplotlib.pyplot as plt
  matplotlib.rc('font', family='Noto Sans CJK KR')

  x = ['2011', '2012', '2013', '2014', '2015']
  plt.plot(x, [1, 3, 2, 5, 4], label='서울')
  plt.plot(x, [2, 1, 3, 1, 1], label='부산')
  plt.yticks([1, 2, 3, 4, 5])
  plt.grid()
  plt.show();
#+END_SRC

#+RESULTS:
[[file:outputs/matplotlib-grid-plot-2.png]]



** figure와 axes 소개

웹상에서 matplotlib에 대한 정보를 리서치하시다보면, 위에서 소개한 것과는 다소 다른 스타일의 사용법도 발견하실 수 있습니다. 이 두 스타일의 차이점과 원리를 이해하시면 코드를 읽어 활용하는데 덜 헷깔리실겁니다.

우선 아래 개념도를 보고 matplotlib가 정의하는 그래프 구조에 대해 알아봅시다.

[[https://matplotlib.org/_images/anatomy.png]]

 - 가장 큰 요소로 =figure= 가 있습니다. =figure= 는 일종의 전체 캔버스라고 볼 수 있습니다.
 - 하나의 =figure= 는 여러개의 차트를 가질 수 있는데, 각 차트를 =Axes= 라고 부릅니다. (=Axis= 가 아닙니다)

본 쳅터에서 설명하던 코드를 다시 한번 살펴볼까요?

#+BEGIN_SRC ipython :session :results raw :exports both :ipyfile outputs/matplotlib-figure-axes-1.png
%matplotlib inline

import matplotlib.pyplot as plt

plt.plot([1, 3, 2, 5, 4])
plt.show();
#+END_SRC

#+RESULTS:
[[file:outputs/matplotlib-figure-axes-1.png]]

위의 코드에는 실제로는 숨겨진 동작이 있습니다. 아래의 코드는 위의 코드와 동일합니다.

#+BEGIN_SRC ipython :session :results raw :exports both :ipyfile outputs/matplotlib-figure-axes-2.png
  %matplotlib inline

  import matplotlib.pyplot as plt

  figure = plt.figure()           # 가장 먼저, 캔버스인 figure를 준비한다
  axes = figure.add_subplot(111)  # 하나의 axes를 추가한다
  axes.plot([1, 3, 2, 5, 4])      # 해당 axes에 그래프를 그린다
  plt.show();                     # 표시한다
#+END_SRC

#+RESULTS:
[[file:outputs/matplotlib-figure-axes-2.png]]

위의 코드에서는 matplotlib의 구성 요소인 figure와 axes가 명확히 드러납니다. pyplot만을 사용하는 방식에서는, ~plt.plot()~ 을 수행하면 내부적으로 기본 ~axes~ 를 생성하고, 이후 ~axes~ 에 관련된 ~plt~ 함수를 실행할 때는 기본 ~axes~ 에 대해 수행합니다.

pyplot을 사용한 간략한 스타일의 사용법은, 간단한 용도로 사용할 때는 간편하지만, 복잡하거나 정교한 제어를 할 때는 figure와 axes를 명시적으로 사용할 필요가 있습니다.


** subplot 그리기

그 중 한 예가 여러 개의 그래프를 한 번에 그리는 것입니다.

~subplots()~ 혹은 ~add_subplot()~

#+BEGIN_SRC ipython :session :results raw :exports both :ipyfile outputs/matplotlib-subplot-1.png
  %matplotlib inline

  import matplotlib.pyplot as plt

  figure = plt.figure()
  axes_1 = figure.add_subplot(2,1,1) # subplot이 2행 1열짜리이고 첫번째 plot임
  axes_1.plot([1, 3, 2, 5, 4])

  axes_2 = figure.add_subplot(2,1,2) # subplot이 2행 1열짜리이고 두번째 plot임
  axes_2.plot([1, 3, 2, 5, 4])
  plt.show();
#+END_SRC

#+RESULTS:
[[file:outputs/matplotlib-subplot-1.png]]

#+BEGIN_SRC ipython :session :results raw :exports both :ipyfile outputs/matplotlib-subplot-2.png
  %matplotlib inline

  import matplotlib.pyplot as plt

  figure = plt.figure()
  axes_1 = figure.add_subplot(1,2,1) # subplot이 1행 2열짜리이고 첫번째 plot임
  axes_1.plot([1, 3, 2, 5, 4])

  axes_2 = figure.add_subplot(1,2,2) # subplot이 2행 2열짜리이고 두번째 plot임
  axes_2.plot([1, 3, 2, 5, 4])
  plt.show();
#+END_SRC

#+RESULTS:
[[file:outputs/matplotlib-subplot-2.png]]
